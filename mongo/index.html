<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>The MongoDB Class - Flask-MongoDB</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../stylesheet/extra.css" rel="stylesheet" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "The MongoDB Class";
        var mkdocs_page_input_path = "mongo.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Flask-MongoDB
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">The MongoDB Class</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#configurations">Configurations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#database-settings">Database settings</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#models-configuration">Models configuration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-the-mongodb-instance-at-runtime">Using the MongoDB instance at runtime</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#app-context">App context</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#current-app-proxy">Current App proxy</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#current-mongo-proxy">Current mongo proxy</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#importing-the-mongodb-instance">Importing the MongoDB instance</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-models-at-runtime">Using models at runtime</a>
    </li>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Database Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../collections/">Models</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data Validation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../serializers/">Serializing Data</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CLI Tool</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cli/">flask-mongodb</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/">API Reference</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Changelog</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Flask-MongoDB</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">The MongoDB Class</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/juanmanuel96/flask-mongodb/edit/master/docs/mongo.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="the-mongodb-class">The MongoDB Class</h1>
<p>The main class of Flask-MongoDB is <code>MongoDB</code>. This class is the one that establishes the connection between he Flask app and the database. It is written the same way all Flask extensions write their code. The class has an optional app parameter and the <code>init_app</code> method. That method is the preferred way of creating the connection.</p>
<p>When a connection has been established, the Flask instance will have a new attribute called <code>mongo</code>. It can be accessed with the <code>current_app</code> proxy or the actual Flask instance.</p>
<h2 id="configurations">Configurations</h2>
<p>The MongoDB class has two configuration variables. These are <code>DATABASE</code> and <code>MODELS</code>. The first one tells the MongoDB instance which databases and connections to use. The <code>MODELS</code> configuration tells the instance where to look for those models. The elements of the list are referred to as model groups.</p>
<h3 id="database-settings">Database settings</h3>
<p>As mentioned above, the database configuration has default values. This default value connects the Flask app to a database of name main in localhost on port 27017, where the database alias is main.</p>
<p><strong>Structure</strong></p>
<pre><code class="language-python">DATABASE = {
    'DB alias': {
        'HOST': 'host of the database',
        'PORT': 'port of the database',
        'NAME': 'name of the database'
    }
}
</code></pre>
<p><strong>Example</strong></p>
<pre><code class="language-python">DATABASE = {
    'main': {
        'HOST': 'localhost',
        'PORT': 27017,
        'NAME': 'main'
    }
}
</code></pre>
<p>The <code>main</code> alias should always be present since by default all models are connected to main. However, it is up to you for setting the DB alias names. If <code>main</code> is not present, you must make sure that no model belongs to the <code>main</code> database. DB aliases on models will be covered later.</p>
<p>It is recommended that in your configurations add a <code>DATABASE</code> variable to overwrite the default configurations and connect to your database. Remember that once you start the application, if the database does not exist it is created automatically. In your <code>DATABASE</code> variable, the first key is the database alias. Its value should be another dictionary with the following keys:</p>
<ol>
<li><code>HOST</code> - Host where the database is located (required)</li>
<li><code>PORT</code> - Port of the database (required)</li>
<li><code>NAME</code> - Name of the database in the connection (required)</li>
<li><code>USERNAME</code> - Username of the account to be used to conduct the DB operations (optional)</li>
<li><code>PASSWORD</code> - Password of the account, required if username is used (optional)</li>
</ol>
<p>These DB configurations needs to be repeated for all databases you wish to connect to the application. Make sure not to repeat aliases.</p>
<h3 id="models-configuration">Models configuration</h3>
<p>The <code>MODELS</code> configuration provides is the main method for registering models to the MongoDB instance automatically and easily. To register models automatically, simply add to the list the package path to the models. For exmaple, if you have a project with the following structure:</p>
<pre><code>api
|__ __init__.py
|__ authentication
    |__ models
        |__ __init__.py
        |__ users.py
    |__ views
        |__ ...
|__ store
    |__ models
        |__ __init__.py
        |__ inventory.py
    |__ views
        |__ ...
</code></pre>
<p>You would want to register your authentication and store models automatically. In your configurations, create a new variable called MODELS. This variable must be a list. You should add <code>api.authentication</code> and <code>api.store</code> to the MODELS variable. Note that you do not add "models" to each of the package paths because the MongoDB instance will automatically search for <code>models</code> inside your packages. Your <code>MODELS</code> variable should look like this:</p>
<pre><code class="language-python">MODELS = [
    'api.authentication',
    'api.store'
]
</code></pre>
<p>If you were to install other packages with Flask-MongoDB models, you would add the path to those models in the <code>MODELS</code> configuration as well. The models file can be treated as package or as a simple file with all of the models in it.</p>
<h2 id="using-the-mongodb-instance-at-runtime">Using the MongoDB instance at runtime</h2>
<p>After you have registered the models and created your endpoints, you will most likely want to use the MongoDB instance through your application to make database operations. This section will explain how to get the MongoDB instance throughout your application.</p>
<h3 id="app-context">App context</h3>
<p>When running a Flask application and importing certain modules or variables, it matters in which context you are making the call. There are proxies for the current application and request, for example. When you initialize the MongoDB object with the Flask instance, the Flask instance gets a new attribute called <code>mongo</code> which is the initialized MongoDB object. This creates two methods of importing the current MongoDB instance in the application context.</p>
<h4 id="current-app-proxy">Current App proxy</h4>
<p>Using the <code>current_app</code> proxy, you can access the instanced MongoDB object through it by accessing the <code>mongo</code> attribute. With the <code>mongo</code> attribute you will have access to all of your MongoDB instance methods and attributes. </p>
<pre><code class="language-python">from flask import current_app

mongo = current_app.mongo
</code></pre>
<h4 id="current-mongo-proxy">Current mongo proxy</h4>
<p>Besides using the <code>current_app</code> proxy, you can use the <code>current_mongo</code> proxy. This proxy basically gets the <code>mongo</code> attribute from the current app and returns it. This makes the calls to the mongo instance to be shorter.</p>
<h3 id="importing-the-mongodb-instance">Importing the MongoDB instance</h3>
<p>In your app initialization file, you have to initialize your MongoDB instance after the Flask instance. After initialization, you can call the MongoDB instance directly like you would with the Flask instance. There is a caveat, though. This will not work with the app factory method or might raise import errors depending on how and where you make the import in your application. This method is highly discouraged.</p>
<h2 id="using-models-at-runtime">Using models at runtime</h2>
<p>While developing your application, you will want to use the models. You can import any of your models as you would import any other class in Python. To use the model, simply initialize it and you can do model operations with it. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../collections/" class="btn btn-neutral float-right" title="Models">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/juanmanuel96/flask-mongodb" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../collections/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
