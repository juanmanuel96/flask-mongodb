<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Forms - Flask-MongoDB</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../stylesheet/extra.css" rel="stylesheet" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Forms";
        var mkdocs_page_input_path = "forms.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Flask-MongoDB
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mongo/">The MongoDB Class</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Database Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../collections/">Models</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data Validation</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Forms</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#how-to-use">How to use</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#creating-a-form">Creating a form</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#validating-data">Validating data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#saving-form-data">Saving form data</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#some-more-notes">Some more notes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-instance-attribute">The instance attribute</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_id-field">_id field</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#embeddeddocumentfield-in-the-form">EmbeddedDocumentField in the form</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#integration-with-flask-wtf">Integration with Flask-WTF</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">CLI Tool</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cli/">flask-mongodb</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/">API Reference</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Changelog</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Flask-MongoDB</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Data Validation</li>
      <li class="breadcrumb-item active">Forms</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/juanmanuel96/flask-mongodb/edit/master/docs/forms.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="collectionmodelform">CollectionModelForm</h1>
<p>To validate data for a collection model, Flask-MongoDB comes prepackaged with a class called <code>CollectionModelForm</code>. This class is an extension of the Form class of WTForms. </p>
<h2 id="how-to-use">How to use</h2>
<p>In this section, we shall create a CollectionModelForm linked with your collection model and how to use it.</p>
<h3 id="creating-a-form">Creating a form</h3>
<p>The following example demonstrates how to create a form.</p>
<pre><code class="language-python">from flask_mongodb.forms.collection import CollectionModelForm
from flask_mongodb.forms.meta import CollectionModelFormMeta
from flask_mongodb.models import CollectionModel, fields
from wtforms import StringField, validators

class MyModel(CollectionModel):
    collection_name = 'my_collection'
    field1 = fields.StringField()

class FormExample(CollectionModelForm):
    class Meta(CollectionModelFormMeta):
        model = MyModel
    field1 = StringField(validators=[validators.DataRequired()])  # Make sure field requirements match that of the model
</code></pre>
<p>The first thing you should notice is the <code>Meta</code> class in the form. While typically this is hidden when normally creating a WTForms Form object, it should be defined for the <code>CollectionModelForm</code> class since you need to define which model the form is related to. This <code>Meta</code> class must always inherit from <code>CollectionModelFormMeta</code> and specify the model with the <code>model</code> attribute.</p>
<p>You should then define the form fields. To avoid issues with the model field's requirements, make sure to add all needed validators to the field that match the field requirements. This is also very important for the DataRequired since by default fields of WTForms are not required and in FlaskMongoDB they are.</p>
<h3 id="validating-data">Validating data</h3>
<p>Form data validation is done as you would for any other WTForms form validation. The following is an example of such operation.</p>
<pre><code class="language-python">data = {
    'field1': 'sample text'
}
form = FormExample(data=data)
form.validate()
</code></pre>
<p>The recommended use for the form is to pass data to the form using the <code>data</code> parameter. However, the <code>formdata</code> parameter will work as well.</p>
<h3 id="saving-form-data">Saving form data</h3>
<p>After the form has been instantiated and validated, you can use the form's <code>save</code> method to save the data in the database. You can save as follows.</p>
<pre><code class="language-python">form.save()
</code></pre>
<p>This method will raise a WTForms <code>ValidationError</code> if the save operation is attempted and the <code>validate</code> method has not been called.</p>
<h2 id="some-more-notes">Some more notes</h2>
<h3 id="the-instance-attribute">The instance attribute</h3>
<p>Every time you save the form, the form's <code>instance</code> attribute is updated. This attribute is the instantiated model with the data assigned as its initial values. It can then be accessed without the need to make a <code>find_one</code> operation.</p>
<h3 id="_id-field"><code>_id</code> field</h3>
<p>All CollectionModel classes have an automatic field labeled <code>_id</code>. It represents the _id field of a document in a MongoDB collection. WTForms does not like fields that begin with an underscore (_). For this reason, all <code>CollectionModelForm</code> objects come with a field labeled <code>oid</code>. It stands for ObjectId, and it's a renaming of the <code>_id</code> field. To get it as <code>_id</code>, the <code>data</code> method replaces <code>oid</code> with <code>_id</code> when ever called. </p>
<h3 id="embeddeddocumentfield-in-the-form">EmbeddedDocumentField in the form</h3>
<p>If your collection has an EmbeddedDocumentField in the model, you can recreate this with the <code>FormField</code> field class of WTForms. The <code>FormField</code> class takes a Form object as one of its arguments. Simply, create a new Form class (you can use WTForms <code>Form</code> class or <code>CollectionModelForm</code> class) with the fields and field requirements matching that of the EmbeddedDocumentField and pass it to the <code>FormField</code> object. Here is an example.</p>
<pre><code class="language-python">from flask_mongodb.forms.collection import CollectionModelForm
from flask_mongodb.forms.meta import CollectionModelFormMeta
from flask_mongodb.models import CollectionModel, fields
from wtforms import Form, FormField, StringField


class MyModel(CollectionModel):
    collection_name = 'my_model'
    top_level_field = fields.StringField(required=False)
    embedded_document = fields.EmbeddedDocumentField(required=False, properties={
        'sample_field': fields.StringField(required=False)
    })


class EmbeddedDocumentForm(Form):
    sample_field = StringField()


class MySampleForm(CollectionModelForm):
    class Meta(CollectionModelFormMeta):
        model = MyModel

    top_level_field = StringField()
    embedded_document = FormField(EmbeddedDocumentForm)
</code></pre>
<p>Use the form as you would use any other CollectionModelForm.</p>
<h2 id="integration-with-flask-wtf">Integration with Flask-WTF</h2>
<p>As of this moment, the CollectionModelForm does not integrate well with Flask-WTF's FlaskForm. The Meta class in <code>FlaskForm</code> is defined the same way you would define the meta class here. While this issue is resolved, a workaround is to copy the CSRF stuff from the FlaskForm to the Meta class of <code>CollectionModelForm</code> as well as the FlaskForm method <code>validate_on_submit</code>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../collections/" class="btn btn-neutral float-left" title="Models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cli/" class="btn btn-neutral float-right" title="flask-mongodb">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/juanmanuel96/flask-mongodb" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../collections/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cli/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
